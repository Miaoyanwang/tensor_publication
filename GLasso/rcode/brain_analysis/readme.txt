# Brain tissue analysis
# Origin: 03/07/21 Lastest Update: 03/11/21

### Scripts ###
To go through the brain tissue analysis, five scripts are needed:

1. Joint_tucker_v6.m : Matlab code for the main algorithm function
2. logdet.m : dependency of the Joint_tucker_v6.m
3. generate_funcs.R : R code to generate the sample covariance matrices and their figures with given gene expression data; ss_data.mat now include a struct "ss_data" and a cell "gene_name", to get valid input of Joint_tucker_v6.m, use gss = struct2cell(ss_data);  

4. pipeline_generate.R : R code to generate various kinds of sample covariance matrices using the functions in generate_funcs.R; 
Input/Dependency: generate_funcs.R, brain_final.rdata, corrected_expression_list_noY.RData
Output: ss_data.mat, 13 jpeg sample covariance matrix figures in folder ./ss_figure/
 
5. pipeline2.m : Matlab code to obtain the algorithm results using Joint_tucker_v6.m; 
Input/Dependency: Joint_tucker_v6.m, logdet.m, ss_data.mat, nvector.csv(sample size for each tissue, unnecessary for pre_pro/ss_data.mat)
Output: U.csv(membership matrix), Theta0.csv(global connection), Theta_l.csv(l = 1,...,r, tissue specified connection), Obj_curve.csv(trajectory of objective value); update: now Theta_l.csv and Theta0.csv has row name!

### Data ###

1. nvector.csv : a csv file recording the sample size for each brain tissue. This file is useless if we use the tensor-form pre-processed data with balanced weight.

2. generated_data : five kinds of sample covariance data generated by pipeline_generate.R, where
 - pre_pro: ss data/figures from pre-processed data
 - gtex_varvar: ss data/figures from original gtex data with genes who have top 300 variance of the variance of each tissue
 - - tissue_name.csv records the brain tissues name
 - - gene_name.csv records the gene symbol select by var-var way; 

Use following codes to translate Ensembl ID to gene symbol:

library(EnsDb.Hsapiens.v79)
geneid = c("ENSG00000006074", ...)
ensembldb::select(EnsDb.Hsapiens.v79, keys= geneid, keytype = "GENEID", columns = c("SYMBOL","GENEID"))

Some ensembl ID can not be translated, and thus keep their original ensembl ID in gene_name.csv. 


(following three are now in old_code since bad performance in clustering)

 - gtex_pre: ss data/figures from original gtex data with same genes in pre_pro
 - gtex_top: ss data/figures from original gtex data with genes who have top 300 variance across all the sample

 - gtex_meanvar: ss data/figures from original gtex data with genes who have top 300 variance of the mean of each tissue

### Tuning parameters ###

The default tuning parameters in pipeline.m are:
 - r = 3
 - rho (penalty parameter) = 1000
 - option.Niter (max iteration) = 30
 - option.tol (stopping threshold) = 1
 - option.initial (initialization) = 1 (HOSVD)

The default setting is the best setting for pre_pro/ss_data.mat. The best setting for gtex_varvar/ss_data.mat is r = 3, rho = 1500. 

### Results ###

Results obtained by the algorithm are stored in folder results, where
 - pre_pro/r3rho1000: has the results with pre_pro/ss_data.mat under r = 3, rho = 1000;
 - gtex_varvar/r3rho1500: has the results with gtex_varvar/ss_data.mat under r = 3, rho = 1500.


 


